<<<<<<< HEAD
var express = require("express");
var terms=[];
var property={};
var location={};
var relations=[];
var relation={};
var date1,date2,diffDays,flag=0;
module.exports = {
  Display_loc_rel:function(locationTerms,profile){
    var db = require("../db/mongoUtil").getConnection();
    Date.daysBetween = function( date1, date2 ) {
      date1_ms = date1.getTime();
      date2_ms = date2.getTime();
      difference_ms = date2_ms - date1_ms;
      difference_ms = difference_ms/(1000*60*60);
       days = Math.floor(difference_ms/24);
      return days ;
    }
     for(arrindex=0;arrindex < locationTerms.length;arrindex++) {
      profile[0].profiles.sections.forEach(function(section,index) {
        section.chicklets.forEach(function(chicklet,index) {
          if( chicklet.chickletid == "PAST"  && chicklet.chicklet_data.place.value == locationTerms[arrindex] )
          {
            flag=1;
            // console.log(locationTerms[arrindex]);
            //  property.term=locationTerms[arrindex];
             date1 = new Date(chicklet.chicklet_data.from_when.value);
             date2 = new Date(chicklet.chicklet_data.to_when.value);
              diffDays=Date.daysBetween(date1,date2);
              relation.relationName="Used To Stay";
              relation.duration=diffDays;
              relations.push(relation);
              relation={};
          }
          else if( chicklet.chickletid == "CURRENT"  && chicklet.chicklet_data.place.value == locationTerms[arrindex])
          {
            flag=1;
            // property.term=locationTerms[arrindex];
             date1 = new Date(chicklet.chicklet_data.from_when.value);
             date2 = new Date();
              diffDays=Date.daysBetween(date1,date2);
              relation.relationName="   stay";
              relation.duration=diffDays;
              relations.push(relation);
              relation={};
          }
         else if( chicklet.chickletid == "ROLES_PLAYED"  && chicklet.chicklet_data.location.value ==  locationTerms[arrindex])
          {
            flag=1;
          //
             date1 = new Date(chicklet.chicklet_data.from_when.value);
             date2 = new Date(chicklet.chicklet_data.to_when.value);
              diffDays=Date.daysBetween(date1,date2);
              relation.relationName="Worked";
              relation.duration=diffDays;
              relations.push(relation);
              relation={};
          }
        });

      });
      if(flag==1){
      property.term=locationTerms[arrindex];
      property.relations=relations;
      flag=0;
      terms.push(property);
      property={};
    }
=======
var nlp = require('nlp_compromise');

module.exports = function(locationTerms,profile) {
  var relation = {};
  var location = {
    term: locationTerms,
    relations: []
  };
  Date.daysBetween = function( date1, date2 ) {
    var date1_ms = date1.getTime();
    var date2_ms = date2.getTime();
    var difference_ms = date2_ms - date1_ms;
    var difference_ms = difference_ms/(1000*60*60);
    var days = Math.floor(difference_ms/24);
    return days ;
  }
  profile.profiles.sections.forEach(function(section,index) {
    section.chicklets.forEach(function(chicklet,index) {
      if( chicklet.chickletid == "PAST"  && nlp.sentence(chicklet.chicklet_data.place.value).normal() == locationTerms)
      {
        var fromDate = chicklet.chicklet_data.from_when.value.split('/');
        var toDate = chicklet.chicklet_data.to_when.value.split('/');
        var date1 = new Date(fromDate[2],fromDate[1],fromDate[0]);
        var date2 = new Date(toDate[2],toDate[1],toDate[0]);
        var diffDays=Date.daysBetween(date1,date2);
          relation.relationName="Used_To_Stay";
          relation.duration=diffDays.toString();
          location.relations.push(relation);
          relation = {};
      }
      else if( chicklet.chickletid == "CURRENT"  && nlp.sentence(chicklet.chicklet_data.place.value).normal() == locationTerms)
      {
          relation.relationName="stay";
          location.relations.push(relation);
          relation = {};
      }
     else if( chicklet.chickletid == "ROLES_PLAYED"  && nlp.sentence(chicklet.chicklet_data.location.value).normal() ==  locationTerms)
      {
        var date1 = new Date(chicklet.chicklet_data.from_when.value);
        var date2 = new Date(chicklet.chicklet_data.to_when.value);
        var diffDays = Date.daysBetween(date1,date2);
          relation.relationName = "Worked";
          relation.duration = diffDays.toString();
          location.relations.push(relation);
          relation = {};
>>>>>>> d2bc2f07c8e3b3ee201ca60b26009b55adc39f37
      }
    });
  });
  return location;      
} 
